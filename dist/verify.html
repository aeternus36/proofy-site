<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Proofy – Verifiera dokument</title>
  <meta name="theme-color" content="#0b1220" />

  <style>
:root{
  --bg:#0b1220;--text:#eaf0ff;--muted:#a9b7d3;
  --border:rgba(255,255,255,.12);--brand:#6ea8ff;--brand2:#7cf1c6;
  --shadow:0 18px 60px rgba(0,0,0,.38);--r:18px;--max:900px;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  color:var(--text);
  background:
    radial-gradient(900px 600px at 15% 10%, rgba(110,168,255,.18), transparent 60%),
    var(--bg);
}
.wrap{max-width:var(--max);margin:0 auto;padding:0 20px}
header{border-bottom:1px solid var(--border);background:rgba(11,18,32,.75)}
.nav{display:flex;justify-content:space-between;align-items:center;padding:14px 0}
.brand{display:flex;gap:10px;font-weight:900;text-decoration:none}
.logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,var(--brand),var(--brand2))}
.btn{padding:12px 16px;border-radius:14px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);color:inherit;font-weight:900;cursor:pointer}
.btn.primary{border:none;background:linear-gradient(135deg,var(--brand),var(--brand2));color:#08101e}
.card{border:1px solid var(--border);border-radius:var(--r);background:linear-gradient(180deg,rgba(255,255,255,.07),rgba(255,255,255,.03));box-shadow:var(--shadow)}
.content{padding:18px}
.mono{font-family:ui-monospace,monospace;word-break:break-all}
.meta{color:var(--muted);font-size:13px}
.ok{color:#7cf1c6;font-weight:900}
.err{color:#ff8aa1;font-weight:900}
input{width:100%;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:rgba(11,18,32,.35);color:var(--text)}
  </style>
</head>

<body>
<header>
  <div class="wrap nav">
    <a class="brand" href="/"><span class="logo"></span>Proofy</a>
    <a class="btn" href="/hash.html">Hasha dokument</a>
  </div>
</header>

<main>
  <div class="wrap">
    <h1>Verifiera dokument</h1>
    <p class="meta">
      Denna sida kan delas som länk. Verifiering sker mot Proofys on-chain-register.
    </p>

    <section class="card content">
      <label class="meta">Verifierings-ID (bytes32)</label>
      <input id="hashInput" placeholder="0x…" />

      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn primary" id="verifyBtn">Verifiera</button>
        <button class="btn" id="copyLinkBtn">Kopiera länk</button>
      </div>

      <div class="meta" id="status" style="margin-top:10px"></div>

      <div id="resultBox" style="display:none;margin-top:12px"></div>
    </section>
  </div>
</main>

<script>
(() => {
  const input = document.getElementById("hashInput");
  const verifyBtn = document.getElementById("verifyBtn");
  const copyLinkBtn = document.getElementById("copyLinkBtn");
  const status = document.getElementById("status");
  const resultBox = document.getElementById("resultBox");

  function setStatus(msg, cls){
    status.textContent = msg || "";
    status.className = cls || "meta";
  }

  function getHashFromUrl(){
    const p = new URLSearchParams(location.search);
    return p.get("hash");
  }

  async function verify(hash){
    setStatus("Verifierar…");
    resultBox.style.display="none";

    const r = await fetch("/api/verify",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ hash })
    });

    const j = await r.json();

    if(!j.ok){
      setStatus(j.error || "Fel vid verifiering","err");
      return;
    }

    if(!j.exists){
      resultBox.innerHTML = "<div class='err'>❌ Dokumentet är inte registrerat</div>";
    } else {
      const date = new Date(j.timestamp*1000).toLocaleString("sv-SE");
      resultBox.innerHTML = `
        <div class="ok">✅ Dokumentet är registrerat</div>
        <div class="meta">Datum: ${date}</div>
        <div class="meta">Submitter:</div>
        <div class="mono">${j.submitter}</div>
      `;
    }

    resultBox.style.display="block";
    setStatus("");
  }

  verifyBtn.onclick = () => {
    const h = input.value.trim();
    if(!h) return setStatus("Ange ett verifierings-ID","err");
    verify(h);
  };

  copyLinkBtn.onclick = () => {
    if(!input.value) return;
    const url = `${location.origin}/verify.html?hash=${input.value}`;
    navigator.clipboard.writeText(url);
    setStatus("Länk kopierad ✅","ok");
  };

  // auto-verify om hash finns i URL
  const h = getHashFromUrl();
  if(h){
    input.value = h;
    verify(h);
  }
})();
</script>

<script src="/chat-widget.js" defer></script>
</body>
</html>

