<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Proofy – Verifiera filversioner för redovisningsbyråer</title>
  <meta name="description" content="Proofy hjälper redovisningsbyråer att visa om en fil matchar en fastställd referens vid kontroll – utan att lagra filinnehåll." />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://proofy.se/" />
  <meta name="theme-color" content="#0b1220" />

  <!-- 5/5 hardtest: integritet/säkerhetsmeta (lågrisk). CSP bör sättas via HTTP-header. -->
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()" />

  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Proofy" />
  <meta property="og:title" content="Proofy – Verifiera filversioner för redovisningsbyråer" />
  <meta property="og:description" content="Verifiera om en fil matchar en fastställd referens vid kontroll – utan att lagra filinnehåll." />
  <meta property="og:url" content="https://proofy.se/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Proofy – Verifiera filversioner för redovisningsbyråer" />
  <meta name="twitter:description" content="Verifiera om en fil matchar en fastställd referens vid kontroll – utan att lagra filinnehåll." />

  <link rel="stylesheet" href="/assets/proofy.css?v=2026-01-10a" />
  <link rel="stylesheet" href="/assets/header.css?v=2026-01-10a" />

  <!-- Favicons (lägg filerna i: dist/assets/logo/favicon/ ) -->
  <link rel="icon" href="/assets/logo/favicon/favicon.ico" sizes="any" />
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/logo/favicon/favicon-32x32.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/logo/favicon/apple-touch-icon.png" />
  <link rel="manifest" href="/assets/logo/favicon/site.webmanifest" />

  <style>
    /* AUDIT/HARDTEST:
       Begränsa visuella overrides till skärm så print/PDF inte förstörs av !important. */
    @media screen{
      html, body { background: #0b1220 !important; }
      body { background-image: none !important; }
      main::before{ content:none !important; }
      main{ background: transparent !important; }
    }

    @media print{
      html, body { background:#fff !important; }
      body{ background-image:none !important; }
    }

    /* NYTT: Säkerställ att navbar-loggan blir SVG (och att ev. gammal CSS-badge inte “tar över”) */
    .brand .logo{
      width: 28px;
      height: 28px;
      display: inline-block;
      flex: 0 0 auto;
      border-radius: 10px;
      background: none !important;
      box-shadow: none !important;
      border: 0 !important;
    }
    .brand img.logo{
      object-fit: contain;
    }

    /* status-pill ska vara tyst tills vi behöver visa något */
    #demoStatus { display:none; }

    /* Lugnare hero-kort: mindre visuell “stökighet” */
    .heroCard{
      padding:18px;
      margin-top:14px;
      border-color: rgba(255,255,255,.10);
      background: rgba(255,255,255,.035);
    }

    .heroCard .small { color: rgba(234,240,255,.86); }
    .heroCard .hr { opacity: .95; }

    .heroMetaRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:10px;
    }

    .proofyPills{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .proofyPills .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .proofyPills .dot{
      width:8px;
      height:8px;
      border-radius:999px;
      background: rgba(120,180,255,.75);
      display:inline-block;
    }

    .noteBox{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 16px;
      padding: 12px 14px;
      margin-top: 10px;
    }
    .noteBox pre{
      margin:0;
      white-space: pre-wrap;
      word-break: break-word;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12.5px;
      line-height: 1.45;
      color: rgba(234,240,255,.9);
    }
    .noteActions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
      align-items:center;
    }

    .grid3{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }
    @media (max-width: 900px){
      .grid3{ grid-template-columns: 1fr; }
    }
    .tile{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 16px;
      padding: 12px 14px;
    }
    .tile b{ display:block; margin-bottom:6px; }

    a:focus-visible, button:focus-visible, input:focus-visible, textarea:focus-visible, summary:focus-visible{
      outline: 2px solid rgba(120,180,255,.55);
      outline-offset: 3px;
      border-radius: 12px;
    }

    .heroCtas{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    /* =========================
       KONTAKT / CTA (UI 5/5)
       - bättre rytm runt knapparna
       - status-pill ska inte skapa “skev” radbrytning
       - mobil: fullbredds-knappar, status på egen rad
    ========================= */
    #kontakt .help{
      margin-top: 8px;
      color: rgba(234,240,255,.78);
      font-size: 13px;
      line-height: 1.45;
    }

    #kontakt .formActions{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-top: 14px;
    }

    #kontakt .ctaGroup{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    #kontakt .ctaMeta{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 240px;
      flex: 1 1 320px;
      color: rgba(234,240,255,.82);
      font-size: 13px;
      line-height: 1.45;
    }

    #kontakt .ctaMeta b{
      color: rgba(234,240,255,.92);
      font-weight: 900;
    }

    #kontakt #demoStatus{
      margin-left: 0 !important;
      display:none; /* visas via JS när det finns text */
      align-self:flex-start;
    }

    /* Mobil: knappar och status blir lättlästa och jämna */
    @media (max-width: 720px){
      #kontakt .formActions{
        flex-direction: column;
        align-items: stretch;
      }
      #kontakt .ctaGroup{
        width: 100%;
      }
      #kontakt .ctaGroup .btn{
        width: 100%;
        justify-content: center;
      }
      #kontakt #demoStatus{
        width: 100%;
      }
      #kontakt .ctaMeta{
        min-width: 0;
      }
    }

    /* Små förbättringar för juridik/revision: fintext blir tydlig, inte “vägg” */
    #kontakt .fineprint{
      margin-top: 12px;
      border-top: 1px solid rgba(255,255,255,.10);
      padding-top: 12px;
      color: rgba(234,240,255,.74);
      font-size: 12.5px;
      line-height: 1.5;
    }
    #kontakt .fineprint b{
      color: rgba(234,240,255,.88);
      font-weight: 900;
    }
  </style>

  <!-- 5/5: korrekt entity-typ (inte “juridik”-tjänst). -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"Proofy",
    "applicationCategory":"BusinessApplication",
    "operatingSystem":"Web",
    "url":"https://proofy.se/",
    "description":"Teknisk verifiering av filversioner mot fastställd referens (kontrollvärde) utan att lagra filinnehåll.",
    "publisher":{
      "@type":"Organization",
      "name":"Proofy",
      "email":"kontakt@proofy.se",
      "url":"https://proofy.se/"
    }
  }
  </script>
</head>

<body>
<a class="skip" href="#main">Hoppa till innehåll</a>

<header>
  <div class="wrap">
    <div class="nav">
      <a class="brand" href="/" aria-label="Proofy">
        <!-- NYTT: riktig SVG-logga i navbar -->
        <img class="logo" src="/assets/logo/proofy-mark.svg" width="28" height="28" alt="" aria-hidden="true" decoding="async" />
        <span>Proofy</span>
      </a>

      <div class="navActions" id="navActionsDesktop">
        <a class="btn soft" href="/pilot.html">Starta pilot</a>
        <a class="btn" href="/verify.html">Verifiera underlag</a>
        <a class="btn" href="/register.html">Skapa Verifierings-ID</a>
        <a class="btn primary" href="#kontakt">Boka kort demo</a>
      </div>

      <details class="mnav" id="mnav">
        <summary class="mnavSummary" aria-label="Öppna meny">
          <span class="mnavIcon" aria-hidden="true"></span>
        </summary>

        <nav class="mnavMenu" aria-label="Meny">
          <a class="mnavLink" href="/pilot.html">Starta pilot</a>
          <a class="mnavLink" href="/verify.html">Verifiera underlag</a>
          <a class="mnavLink" href="/register.html">Skapa Verifierings-ID</a>
          <a class="mnavLink mnavLinkPrimary" href="#kontakt">Boka kort demo</a>

          <div class="mnavMeta">
            <div class="mnavNote">För byråer · revision · granskning</div>
            <a class="mnavMail" href="mailto:kontakt@proofy.se">kontakt@proofy.se</a>
          </div>
        </nav>
      </details>
    </div>
  </div>
</header>

<main id="main">
  <div class="wrap">
    <div class="badge">För redovisningsbyråer · revision · granskning</div>

    <h1 class="pageTitle">Verifiera filversioner mot fastställd referens – när kontrollen faktiskt görs.</h1>

    <p class="lead">
      När ett bokslut, avtal eller beslut granskas i efterhand behöver ni kunna visa om filen ni kontrollerar
      <strong>matchar samma filversion som en tidigare fastställd referens</strong> – även om den flyttats mellan system, personer och lagringsplatser.
      Proofy möjliggör detta <strong>utan att lagra filinnehåll</strong>.
    </p>

    <!-- EN (1) auktoritativ avgränsning. Inga dubletter på resten av sidan. -->
    <p class="small" style="margin-top:10px; max-width:92ch;">
      <b>Avgränsning (viktig):</b> Proofy är ett <b>tekniskt verifieringsunderlag</b> för filversioner (kontrollvärde/fingeravtryck).
      Tjänsten visar endast om en fil <b>matchar en fastställd referens vid kontrolltillfället</b>.
      Proofy avgör inte dokumentets innehåll, riktighet, äkthet, giltighet eller signering och ersätter inte
      professionellt omdöme, internkontroll, revision, arkivering, e-signering eller juridisk bedömning.
    </p>

    <div class="card heroCard">
      <div class="heroCtas" style="margin-top:12px;">
        <a class="btn primary" href="#kontakt">Boka kort demo</a>
        <a class="btn soft" href="/pilot.html">Starta pilot</a>
        <a class="btn ghost" href="#anvandning">Så fungerar det</a>
      </div>

      <div class="heroMetaRow small" style="margin-bottom:0;">
        <span><b>Pilot 30 dagar:</b> 4 900 kr exkl. moms</span>
        <span>·</span>
        <span>Faktura</span>
        <span>·</span>
        <span>Ingen bindning efter pilot</span>
      </div>

      <div class="hr"></div>

      <div class="proofyPills">
        <span class="badge"><span class="dot" aria-hidden="true"></span>Inget filinnehåll lagras</span>
        <span class="badge"><span class="dot" aria-hidden="true"></span>Verifierings-ID i ärendet</span>
        <span class="badge"><span class="dot" aria-hidden="true"></span>Verifiering på sekunder</span>
      </div>

      <p class="small" style="margin-top:10px; margin-bottom:0;">
        Rekommenderat upplägg: skapa Verifierings-ID när filversionen fastställs, spara ID i ärendet och verifiera vid behov
        (t.ex. intern kvalitetskontroll eller efterhandsgranskning).
      </p>

      <div class="hr"></div>

      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <a class="btn" href="/register.html">Skapa Verifierings-ID</a>
        <a class="btn" href="/verify.html">Verifiera underlag</a>
      </div>
    </div>

    <section id="anvandning" style="margin-top:28px;">
      <h2>Tydlig användning i byråprocess (kortfattat)</h2>

      <div class="card content">
        <div class="grid3" style="margin-top:12px;">
          <div class="tile">
            <b>Syfte</b>
            <span class="small">Stöd för dokumentation: visa om filversionen matchar en fastställd referens vid kontroll i efterhand.</span>
          </div>
          <div class="tile">
            <b>Begränsning</b>
            <span class="small">Se avgränsningen högst upp på sidan (gäller hela tjänsten).</span>
          </div>
          <div class="tile">
            <b>Dataminimering</b>
            <span class="small">Filen lämnar inte datorn via Proofys funktion; endast Verifierings-ID och relevanta kontrolluppgifter hanteras i registret.</span>
          </div>
        </div>

        <div class="hr"></div>

        <h3>Notering att klistra in i ärendet (valfritt)</h3>
        <p class="small" style="margin-top:6px; margin-bottom:0;">
          Kopiera och komplettera med ert Verifierings-ID och eventuell rutin/ärendereferens.
        </p>

        <div class="noteBox" id="proofyNoteBox">
<pre id="proofyNoteText">PROOFY – Verifieringsnotering (ärende)
Verifierings-ID: [ange]
Referens: Fastställd filversion (kontrollvärde) registrerad hos Proofy.
Kontroll: Underlaget verifieras vid behov (t.ex. intern kvalitetskontroll/efterhandsgranskning).

Kontrolltid (Proofy, när kontroll görs): [ange]
Kontrolltid (UTC): [ange]
Obs: Kontrolltid är tidpunkten för kontrolltillfället (ej extern tidsstämpling). Bevisvärde bedöms i sitt sammanhang.

Resultat vid kontrolltillfället: [matchar / matchar inte / kunde inte kontrolleras]
Avgränsning: Proofy visar endast om filversionen matchar referensen. Ingen bedömning av innehållets saklighet/riktighet/äkthet.</pre>
          <div class="noteActions">
            <button class="btn soft" type="button" id="copyNoteBtn">Kopiera notering</button>
            <a class="btn ghost" href="/register.html">Skapa Verifierings-ID</a>
            <a class="btn ghost" href="/verify.html">Verifiera underlag</a>
          </div>
          <span class="small" id="copyNoteStatus" style="display:none; margin-top:8px;" aria-live="polite" role="status"></span>
        </div>
      </div>
    </section>

    <section id="nytta" style="margin-top:28px;">
      <h2>För byråer</h2>
      <div class="card content">
        <p>
          Proofy är byggt för byråers vardag: många ärenden, många versioner och hög kostnad när ett underlag ifrågasätts i efterhand.
          Ni får ett <strong>Verifierings-ID</strong> att spara i ärendet, som gör det enkelt att visa om filen ni kontrollerar
          <strong>matchar samma filversion som den registrerade referensen</strong> vid kontroll.
        </p>

        <div class="grid3" style="margin-top:14px;">
          <div class="tile">
            <b>Varför det behövs</b>
            <span class="small">Filer flyttas, byter namn och skickas mellan system. Proofy ger ett tekniskt sätt att visa om en fil matchar en fastställd referens vid kontroll.</span>
          </div>
          <div class="tile">
            <b>Vad ni får</b>
            <span class="small">Verifierings-ID i ärendet + möjlighet att verifiera filversionen på sekunder när det behövs.</span>
          </div>
          <div class="tile">
            <b>Vad Proofy inte är</b>
            <span class="small">Se avgränsningen högst upp på sidan (gäller hela tjänsten).</span>
          </div>
        </div>

        <div class="card content" style="margin-top:18px;">
          <h3>Så används Proofy i praktiken</h3>

          <p>
            1) När ett underlag fastställs (t.ex. bokslut, rapport, beslut, avtal) skapar ni ett <strong>Verifierings-ID</strong> och sparar det i ärendet.
          </p>

          <p>
            2) Om underlaget behöver styrkas senare verifierar ni filen på några sekunder och ser om den
            <strong>matchar referensen vid kontrolltillfället</strong>.
          </p>
        </div>

        <div class="card content" style="margin-top:18px;">
          <h3>Typiska situationer där Proofy passar</h3>
          <div class="grid3" style="margin-top:12px;">
            <div class="tile">
              <b>Bokslut &amp; rapporter</b>
              <span class="small">Visa om den filversion som låg till grund för beslut/rapportering matchar referensen vid kontroll i efterhand.</span>
            </div>
            <div class="tile">
              <b>Beslut &amp; avtal</b>
              <span class="small">Visa om dokumentet i ärendet matchar samma filversion som vid fastställande, även efter systembyten eller överlämningar.</span>
            </div>
            <div class="tile">
              <b>Kvalitetskontroll</b>
              <span class="small">Snabb kontroll vid intern granskning eller när någon ber om “vilken version var det?”.</span>
            </div>
          </div>

          <p class="small" style="margin-top:12px; margin-bottom:0;">
            Passar när ni behöver ett objektivt sätt att visa om ett underlag (en fil) matchar en fastställd referens vid kontroll i efterhand.
          </p>
        </div>
      </div>
    </section>

    <section id="kontakt" style="margin-top:28px;">
      <h2>Kontakta oss</h2>
      <div class="card content">
        <p class="lead" style="font-size:16px; margin:0 0 10px;">
          Be om en kort demo (10–15 min) eller starta en pilot. Ni får svar normalt inom 1 arbetsdag.
        </p>

        <form class="form" id="demoForm" action="/api/contact" method="POST" novalidate>
          <p style="display:none;">
            <label>Don’t fill this out: <input name="bot-field" autocomplete="off" tabindex="-1" /></label>
          </p>

          <input
            type="text"
            name="company_website"
            tabindex="-1"
            autocomplete="new-password"
            inputmode="none"
            aria-hidden="true"
            value=""
            style="position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden;"
          />

          <input type="hidden" id="proofy_token" name="proofy_token" value="" />
          <input type="hidden" id="proofy_ts" name="proofy_ts" value="" />

          <div class="formGrid">
            <div>
              <label class="label" for="name">Namn <span class="req">*</span></label>
              <input id="name" name="name" type="text" autocomplete="name" required data-required="true" placeholder="För- och efternamn" />
            </div>
            <div>
              <label class="label" for="email">E-post <span class="req">*</span></label>
              <input id="email" name="email" type="email" autocomplete="email" required data-required="true" placeholder="namn@byra.se" />
            </div>
            <div>
              <label class="label" for="company">Byrå / företag</label>
              <input id="company" name="company" type="text" autocomplete="organization" placeholder="t.ex. Exempelbyrån AB" />
            </div>
            <div>
              <label class="label" for="volume">Ungefärlig volym</label>
              <input id="volume" name="volume" type="text" placeholder="t.ex. 50–200 underlag/månad" />
            </div>
          </div>

          <div style="margin-top:12px;">
            <label class="label" for="message">Vad vill ni kunna styrka eller verifiera i efterhand? <span class="req">*</span></label>
            <textarea
              id="message"
              name="message"
              rows="6"
              required
              data-required="true"
              aria-describedby="messageHelp"
              placeholder="Exempel: bokslutsunderlag, beslut, avtal eller kundunderlag som kan ifrågasättas senare. Skriv gärna ett kort scenario (när, varför och vem som brukar fråga)."
            ></textarea>
            <div class="help" id="messageHelp">
              <b>Alternativ:</b> mejla kontakt@proofy.se. (Skriv gärna 2–3 rader om ert scenario.)
            </div>
          </div>

          <!-- UI-FIX: bättre layout kring knappar + meta + status -->
          <div class="formActions">
            <div class="ctaGroup" aria-label="Åtgärder">
              <button class="btn primary" id="demoSubmitBtn" type="submit">Skicka förfrågan</button>
              <a class="btn soft" href="/pilot.html">Se pilotupplägg</a>
            </div>

            <div class="ctaMeta">
              <div><b>Svarstid:</b> normalt inom 1 arbetsdag.</div>
              <div><b>Tips:</b> undvik personnummer eller andra känsliga personuppgifter i fritext.</div>
            </div>

            <span id="demoStatus" class="pill" aria-live="polite" role="status"></span>
          </div>

          <!-- Juridik + dataminimering: tydligt men inte “överförklarat” -->
          <div class="fineprint">
            <b>Dataminimering:</b> Formuläret tar emot kontaktuppgifter och er beskrivning för att hantera förfrågan (demo/pilot).
            <b>Inga dokument eller filer</b> bifogas eller överförs via formuläret.
            Uppgifter hanteras enligt <a href="/privacy.html">Integritetspolicyn</a> och sparas endast så länge det behövs för återkoppling och dokumentation.
          </div>
        </form>

      </div>
    </section>

  </div>
</main>

<footer>
  <div class="wrap">
    <div class="foot">
      <div>
        <div style="color: rgba(234,240,255,.86); font-weight:800;">Proofy</div>
        <div class="small">© 2026 Proofy. Alla rättigheter förbehållna.</div>
      </div>
      <div class="links">
        <a href="/security.html">Säkerhet</a>
        <a href="/privacy.html">Integritet</a>
        <a href="/terms.html">Villkor</a>
        <a href="/cookies.html">Cookies</a>
        <a href="#kontakt">Kontakt</a>
      </div>
    </div>
  </div>
</footer>

<script>
(() => {
  // Kopiera “notering att klistra in”
  const copyBtn = document.getElementById("copyNoteBtn");
  const noteText = document.getElementById("proofyNoteText");
  const copyStatus = document.getElementById("copyNoteStatus");

  function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

  function isRetryableStatus(status){
    return status === 408 || status === 425 || status === 429 || (status >= 500 && status <= 599);
  }

  async function fetchJsonWithTimeout(url, options = {}, timeoutMs = 20000){
    const controller = new AbortController();
    const t = setTimeout(() => controller.abort(), timeoutMs);

    try{
      const res = await fetch(url, {
        ...options,
        signal: controller.signal,
        cache: "no-store",
        credentials: "same-origin"
      });
      const data = await res.json().catch(() => ({}));
      const dateHeader = res?.headers?.get ? (res.headers.get("Date") || "") : "";
      return { ok: res.ok, status: res.status, data, aborted:false, dateHeader };
    } catch (e){
      const aborted = (e && e.name === "AbortError");
      return { ok:false, status: 0, data:{}, aborted, dateHeader:"" };
    } finally {
      clearTimeout(t);
    }
  }

  async function fetchWithRetry(url, options, timeoutMs, attempts = 3){
    const baseDelay = 550;
    for (let i=0; i<attempts; i++){
      const res = await fetchJsonWithTimeout(url, options, timeoutMs);
      if (res.ok) return res;

      const retryable = res.aborted || isRetryableStatus(res.status);
      if (i < attempts - 1 && retryable){
        const jitter = Math.floor(Math.random() * 180);
        await sleep(baseDelay * (i + 1) + jitter);
        continue;
      }
      return res;
    }
    return { ok:false, status:0, data:{}, aborted:false, dateHeader:"" };
  }

  async function copyToClipboard(text){
    try{
      if (navigator.clipboard && window.isSecureContext){
        await navigator.clipboard.writeText(text);
        return true;
      }
      const ta = document.createElement("textarea");
      ta.value = text;
      ta.setAttribute("readonly", "");
      ta.style.position = "absolute";
      ta.style.left = "-10000px";
      ta.style.top = "0";
      document.body.appendChild(ta);
      ta.select();
      const ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return ok;
    } catch {
      return false;
    }
  }

  if (copyBtn && noteText){
    copyBtn.addEventListener("click", async () => {
      const ok = await copyToClipboard(noteText.textContent || "");
      if (!copyStatus) return;

      copyStatus.style.display = "inline-block";
      copyStatus.textContent = ok ? "Notering kopierad." : "Kunde inte kopiera. Markera texten och kopiera manuellt.";
      copyStatus.style.color = ok ? "rgba(180,255,200,.95)" : "rgba(255,170,170,.95)";
      setTimeout(() => { copyStatus.style.display = "none"; }, 2600);
    });
  }

  // Demoformulär
  const form = document.getElementById("demoForm");
  if (!form) return;

  const statusEl = document.getElementById("demoStatus");
  const submitBtn = document.getElementById("demoSubmitBtn");

  function setStatus(text, tone){
    if (!statusEl) return;

    statusEl.style.display = "inline-block";
    statusEl.textContent = text;

    statusEl.style.fontWeight = "800";
    statusEl.style.border = "1px solid rgba(255,255,255,.14)";
    statusEl.style.background = "rgba(255,255,255,.06)";
    statusEl.style.color = "rgba(234,240,255,.92)";

    if (tone === "ok"){
      statusEl.style.background = "rgba(50, 205, 50, .10)";
      statusEl.style.border = "1px solid rgba(50, 205, 50, .25)";
    } else if (tone === "err"){
      statusEl.style.background = "rgba(255, 80, 80, .10)";
      statusEl.style.border = "1px solid rgba(255, 80, 80, .25)";
    } else if (tone === "wait"){
      statusEl.style.background = "rgba(120, 180, 255, .10)";
      statusEl.style.border = "1px solid rgba(120, 180, 255, .25)";
    }
  }

  function disableForm(disabled){
    if (submitBtn) submitBtn.disabled = disabled;
    const fields = form.querySelectorAll("input, textarea, select, button");
    fields.forEach(el => {
      if (el === submitBtn) return;
      el.disabled = disabled;
    });
  }

  function clearFieldHints(){
    const hinted = form.querySelectorAll("[data-proofy-hint='1']");
    hinted.forEach(el => {
      el.style.outline = "";
      el.style.outlineOffset = "";
      el.setAttribute("data-proofy-hint", "0");
    });
  }

  function hintField(el){
    if (!el) return;
    el.style.outline = "2px solid rgba(255,80,80,.6)";
    el.style.outlineOffset = "2px";
    el.setAttribute("data-proofy-hint", "1");
  }

  function firstMissingRequiredFromFormData(fd){
    const required = form.querySelectorAll("[data-required='true']");
    for (const el of required) {
      const name = el.getAttribute("name");
      if (!name) continue;
      const v = fd.get(name);
      if (!String(v || "").trim()) return el;
    }
    return null;
  }

  async function initAntiSpamToken(){
    const t = document.getElementById("proofy_token");
    const ts = document.getElementById("proofy_ts");

    const res = await fetchWithRetry("/api/form-token", { method:"GET" }, 15000, 3);
    const data = res.data || {};

    if (res.ok && data && data.ok === true && data.token) {
      if (t) t.value = data.token;
      if (ts) ts.value = String(Date.now());
      return true;
    }
    return false;
  }

  initAntiSpamToken().then(ok => {
    if (!ok) setStatus("Kunde inte initiera formulärsäkerhet. Ladda om sidan och försök igen.", "err");
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    clearFieldHints();

    const hpNewEl = form.querySelector("input[name='company_website']");
    const hpOldEl = form.querySelector("input[name='bot-field']");
    if (hpNewEl) hpNewEl.value = "";
    if (hpOldEl) hpOldEl.value = "";

    const tokenEl = document.getElementById("proofy_token");
    if (!tokenEl || !String(tokenEl.value || "").trim()) {
      const ok = await initAntiSpamToken();
      if (!ok || !tokenEl || !String(tokenEl.value || "").trim()) {
        setStatus("Kunde inte initiera formulärsäkerhet. Ladda om sidan och försök igen.", "err");
        return;
      }
    }

    const fd = new FormData(form);

    const missing = firstMissingRequiredFromFormData(fd);
    if (missing){
      hintField(missing);
      missing.focus();
      setStatus("Kontrollera att namn, e-post och beskrivning är ifyllda.", "err");
      return;
    }

    try{
      disableForm(true);
      setStatus("Skickar…", "wait");

      const body = new URLSearchParams();
      for (const [k, v] of fd.entries()) body.append(k, String(v));

      const send = await fetchWithRetry(form.action, {
        method: "POST",
        headers: { "content-type": "application/x-www-form-urlencoded;charset=UTF-8" },
        body: body.toString()
      }, 20000, 2);

      const data = send.data || {};
      const httpStatus = send.status || 0;

      if (!send.ok || data.ok !== true || data.sent !== true){
        if (data.ignored === true){
          setStatus("Förfrågan kunde inte skickas. Ladda om sidan och försök igen, eller mejla kontakt@proofy.se.", "err");
          disableForm(false);
          return;
        }

        if (send.aborted){
          setStatus("Timeout: kunde inte skicka just nu. Försök igen eller mejla kontakt@proofy.se.", "err");
          disableForm(false);
          return;
        }

        const msg = data.error || `Kunde inte skickas (HTTP ${httpStatus || "?"}). Försök igen eller mejla kontakt@proofy.se.`;
        setStatus(msg, "err");
        disableForm(false);
        return;
      }

      setStatus("Skickat ✅ Vi återkommer inom 1 arbetsdag.", "ok");
      form.reset();
      disableForm(false);

    } catch (err){
      setStatus("Kunde inte skickas. Försök igen eller mejla kontakt@proofy.se.", "err");
      disableForm(false);
    }
  });
})();
</script>

<script src="/assets/header-toggle.js?v=2026-01-10a" defer></script>
<script src="/chat-widget.js?v=2026-01-10a" defer></script>
</body>
</html>
